<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GraceWell Methodist Church</title>
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-storage.js"></script>
  <!-- Custom CSS -->
  <link rel="stylesheet" href="././css_files/contact_page.css">
  <link rel="stylesheet" href="././css_files/global.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <style>
            .input-container {
            display: flex;
            flex-direction: column;
            /* Place children in a column layout */
            align-items: flex-start;
            /* Align children to the left */
        }

        .auto-width-input {
            width: 100%;
            /* Set the input to 100% width of its container */
            height: 40px;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin-bottom: 5px;
        }

        button {
            background-color: #0059ff;
            color: #fff;
            border: none;
            padding: 5px 5px;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background-color: #0059ff;
        }

        /* Style for the navigation bar */
        .navbar {
            background-color: #3498db;
            overflow: hidden;
        }

        .navbar a {
            float: left;
            display: block;
            color: #fff;
            text-align: center;
            padding: 14px 16px;
            text-decoration: none;
        }

        .navbar a:hover {
            background-color: #258cd1;
        }

        /* Style for images */
        #photo-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            /* Create a responsive grid */
            gap: 10px;
            /* Add some spacing between images */
            list-style: none;
            /* Remove list bullet points */
            padding: 0;
            /* Remove default padding */
        }

        #photo-list img {
            max-width: 100%;
            /* Adjust the maximum width as needed */
            height: auto;
            /* Maintain aspect ratio */
        }

        .photo-container {
            position: relative;
        }

        .photo-container button {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: #e74c3c;
            color: #fff;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }

        .photo-container button:hover {
            background: #c0392b;
        }
    </style>
</head>

<body>
  <div id="app">
    <!-- Navigation bar -->
    <nav class="navbar navbar-expand-md navbar-dark bg-dark">
      <a class="navbar-brand" href="././index.html" target="_self"></a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item"><a class="nav-link" href="https://xbcis-group.github.io/GraceWell_Methodist_Church.github.io/home_page.html" target="_self">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="././about_page.html" target="_self">About</a></li>
          <li class="nav-item"><a class="nav-link" href="././contact_page.html" target="_self">Contact</a></li>
          <li class="nav-item"><a class="nav-link" href="././donations_page.html" target="_self">Donations</a></li>
          <li class="nav-item"><a class="nav-link" href="././appointments_page.html" target="_self">Appointments</a>
          </li>
          <li class="nav-item"><a class="nav-link" href="././get_involved_page.html" target="_self">Get Involved</a>
          </li>
          <li class="nav-item"><a class="nav-link" href="#">Sign In</a></li>
        </ul>
      </div>
    </nav>

    <!-- Header Image with Welcome Message -->
    <div class="header-image">
      <div class="center-panel">
        <h1>Ephesians 2:19-21</h1>
        <p>"So then you are no longer strangers and aliens, but you are fellow citizens with the saints and members of
          the household of God, built on the foundation of the apostles and prophets, Christ Jesus himself being the
          cornerstone, in whom the whole structure, being joined together, grows into a holy temple in the Lord.</p>
      </div>
    </div>

    <!-- Page content -->
    <section class="content-section">
      <h1 class="content-header">Delete User Data</h1>
      <div id="content">
        <br><br>
        <p>Enter your email to request data deletion:</p>
        <label for="email">Email:</label>
        <input type="email" id="email" placeholder="Enter the email to delete">
        <label for="password">Password:</label>
        <input type="password" id="password" placeholder="Enter your password">
        <!-- Buttons are moved below the input fields -->
        <button onclick="signIn()">Sign In</button>
        <button onclick="deleteUser()">Delete User Account</button>
        <div id="status"></div>
        <ul id="requests-list"></ul>
      </div>
      </div>
      <a href="privatepolicy.html" style="color: #000;"><p>Privacy Policy</p></a>

    </section>

    <!-- Footer -->
    <footer class="footer">
      <div class="footer-content">
        <p class="footer-label">Â© GraceWell Methodist Church. All rights reserved.</p>
        <div class="footer-links">
          <p class="footer-label">Follow Us:</p>
          <!-- Facebook icon: https://www.flaticon.com/free-icons/facebook -->
          <a href="https://www.facebook.com/GraceWellMC/"><img src="././website_images/facebook-logo(edited).png"
              alt="facebook" class="footer-image"></a>
          <!-- Instagram icon: https://www.flaticon.com/free-icons/instagram-sketched -->
          <a href="https://www.instagram.com/gracewellmc/"><img src="././website_images/instagram-logo(edited).png"
              alt="instagram" class="footer-image"></a>
          <!-- LinkedIn icon: https://www.flaticon.com/free-icons/linkedin -->
          <a href="https://za.linkedin.com/in/gracewell-methodist-church-807389219"><img
              src="././website_images/linkedin-square-logo(edited).png" alt="linkedin" class="footer-image"></a>
          <p class="footer-label" style="margin-left: 30px;">Download Our App:</p>
          <!--App Store Icon: https://www.flaticon.com/free-icons/app-->
          <a href="#"><img src="././website_images/app-store-logo(edited).png" alt="appstore" class="footer-image"></a>
          <!--Play Store: https://www.flaticon.com/free-icons/playstore-->
          <a href="#"><img src="././website_images/google-playstore-logo(edited).png" alt="playstore"
              class="footer-image"></a>
        </div>
      </div>
    </footer>
  </div>
  <script>
    // Replace with your Firebase project configuration
    var firebaseConfig = {
        apiKey: "AIzaSyBW95P-YZ0GWJDdc_VYF8KC5VhDU5y9278",
        authDomain: "gracewelldatabase.firebaseapp.com",
        databaseURL: "https://gracewelldatabase-default-rtdb.europe-west1.firebasedatabase.app",
        storageBucket: "gracewelldatabase.appspot.com"
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // Function to sign in the user
    function signIn() {
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;

        if (email && password) {
            firebase.auth().signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    // User signed in successfully
                    const user = userCredential.user;
                    alert("Sign In Successful!");
                })
                .catch((error) => {
                    const errorCode = error.code;
                    const errorMessage = error.message;
                    alert("Sign In Error:", errorMessage);
                });
        } else {
            console.error("Please enter both email and password.");
        }
    }

    // Function to delete the user account and related data
    function deleteUser() {
        const emailToDelete = document.getElementById("email").value;
        const user = firebase.auth().currentUser;

        if (user) {
            // Delete the user account
            user.delete()
                .then(() => {
                    // User account deleted successfully
                    console.log("User Account Deleted Successfully");
                    // Now, let's delete related data from the Realtime Database
                    deleteUserData(emailToDelete);
                })
                .catch((error) => {
                    const errorCode = error.code;
                    const errorMessage = error.message;
                    console.error("Delete User Error:", errorMessage);
                });
        } else {
            console.error("No user is signed in.");
        }
    }

    function deleteUserData(emailToDelete) {
const ref = database.ref(); // Change this reference to match your database structure

ref.once("value", (snapshot) => {
    snapshot.forEach((child) => {
        const data = child.val();
        if (data.email === emailToDelete) {
            child.ref.remove()
                .then(() => {
                    console.log("Data related to the email is deleted.");
                })
                .catch((error) => {
                    console.error("Error deleting data:", error);
                });
        }
    });

    // Now, let's also delete the email from other locations in the database (e.g., "appointments," "ministryJoin," "volunteers")
    const otherLocations = ["appointments", "ministryJoin", "volunteers"];
    otherLocations.forEach((location) => {
        const locationRef = database.ref(location);
        locationRef.once("value", (locationSnapshot) => {
            locationSnapshot.forEach((locationChild) => {
                const locationData = locationChild.val();
                if (locationData.email === emailToDelete) {
                    locationChild.ref.remove()
                        .then(() => {
                            console.log(`Email removed from ${location}.`);
                        })
                        .catch((error) => {
                            console.error(`Error removing email from ${location}:`, error);
                        });
                }
            });
        });
    });
});
}
</script>
  <!-- Bootstrap JS (Popper.js and jQuery are required for Bootstrap) -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.1/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

  <!-- Vue.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>

  <!-- Custom JavaScript code -->
  <script src="././js_files/global.js"></script>

</body>

</html>